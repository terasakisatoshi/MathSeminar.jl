<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
   <link rel="stylesheet" href="/MathSeminar.jl/libs/katex/katex.min.css">
   
   <link rel="stylesheet" href="/MathSeminar.jl/libs/highlight/github.min.css">
   
  

  <link href="/MathSeminar.jl/css/franklin.css" rel="stylesheet">
  <link href="/MathSeminar.jl/css/vela.css" rel="stylesheet">
  <script src="/MathSeminar.jl/libs/vela/jquery.min.js"></script>
  <link rel="stylesheet" href="/MathSeminar.jl/css/theorem.css">
   <title>Implement more Julian</title>  
  <!-- PLOTLY -->
  

  <title>Franklin Example | Vela</title>
</head>
<body>
  <div class="main-nav" id="menu">
    <div class="flex-container">
      <span class="sidebar-brand">
        <h3 style='font-size: 25px'>MathSeminar.jl</h3>
      </span>
    </div> <!-- class="flex-container" -->

    <nav class="sidebar-nav">
      <ul class="metismenu"  id="metismenu" >
        <li><a href="/MathSeminar.jl/index.html">Home</a></li>
        <li><a href="" class="has-arrow">Slide Show</a>
          <ul>
            <li><a href="/MathSeminar.jl/slideshow/remark/build/">Introduction to Remark.jl</a>
            <li><a href="/MathSeminar.jl/slideshow/franklin/build">Introduction to Franklin.jl</a>
            <li><a href="/MathSeminar.jl/slideshow/dash/build">Introduction to Dash.jl</a>
            <li><a href="/MathSeminar.jl/slideshow/binarybuilder/build">Introduction to BinaryBuilder.jl</a>
            <li><a href="/MathSeminar.jl/slideshow/myworkflow/build">Introduction to MyWorkflow.jl</a>
            <li><a href="/MathSeminar.jl/slideshow/repl/build">Do something great in your REPL</a>
            <li><a href="/MathSeminar.jl/slideshow/intro2julia/build">Into2Julia</a>
            <li><a href="/MathSeminar.jl/slideshow/pycallchainrules/build">PyCallChainRules</a>
          </ul>
        </li>
        <li><a href="" class="has-arrow">Programming</a>
          <ul>
            <li><a href="/MathSeminar.jl/programming/clang">C</a></li>
            <li><a href="/MathSeminar.jl/programming/rust">Rust</a></li>
            <li><a href="/MathSeminar.jl/programming/benchmark_part1"> Julia benchmark Part1 </a></li>
            <li><a href="/MathSeminar.jl/programming/benchmark_part2"> Julia benchmark Part2 </a></li>
            <li><a href="/MathSeminar.jl/programming/literatejl">Literate.jl</a></li>
            <li><a href="/MathSeminar.jl/programming/sympy">SymPy.jl</a></li>
            <li><a href="/MathSeminar.jl/programming/franklin">Franklin.jl</a></li>
            <li><a href="/MathSeminar.jl/programming/weave">Weave.jl</a></li>
            <li><a href="/MathSeminar.jl/programming/theoremcounter">Theorem Counter</a></li>
            <li><a href="/MathSeminar.jl/programming/images">Images.jl</a></li>
            <li><a href="/MathSeminar.jl/programming/rcall">RCall.jl</a></li>
            <li><a href="/MathSeminar.jl/programming/asciinema">asciinema</a></li>
          </ul>
        </li>
        <li><a href="" class="has-arrow">Gallery</a>
          <ul>
            <li><a href="/MathSeminar.jl/gallery/animation/">Plots.jl animation</a></li>
            <li><a href="/MathSeminar.jl/gallery/curve/">Plots.jl curve</a></li>
            <li><a href="/MathSeminar.jl/gallery/gr/">GR.jl</a></li>
            <li><a href="/MathSeminar.jl/gallery/plotlyjs1/">PlotlyJS.jl Part1</a></li>
            <li><a href="/MathSeminar.jl/gallery/plotlyjs2/">PlotlyJS.jl Part2</a></li>
            <li><a href="/MathSeminar.jl/gallery/plotlyjs3/">PlotlyJS.jl Part3</a></li>
            <li><a href="/MathSeminar.jl/gallery/jsxgraph_js/">JSXGraph (JS)</a></li>
            <li><a href="/MathSeminar.jl/gallery/jsxgraph_jl/">JSXGraph (Julia)</a></li>
            <li><a href="/MathSeminar.jl/gallery/wglmakie/">WGLMakie.jl</a></li>
          </ul>
        </li>
        <li><a href="" class="has-arrow">Topics in Mathematics</a>
          <ul>
            <li><a href="/MathSeminar.jl/mathematics/linearalgebra/chapter0">Linear Algebra</a></li>
            <li><a href="/MathSeminar.jl/mathematics/statistics/dice">Dice</a></li>
            <li><a href="/MathSeminar.jl/mathematics/statistics/Chisq">Chisq Distributions</a></li>
            <li><a href="/MathSeminar.jl/mathematics/statistics/Law_of_Large_Numbers">Law_of_Large_Numbers</a></li>
            <li><a href="/MathSeminar.jl/mathematics/visualizations/triangular_function_addition_theorem">Triangular function addition theorem</a></li>
          </ul>
        </li>
      </ul>
    </nav>
  </div> <!-- main nav menu -->

  <main id="panel">
    <div class="toggle-button hamburger hamburger--spin">
      <div class="hamburger-box">
        <div class="hamburger-inner"></div>
      </div>
    </div>
    <h1 class="page title">Implement more Julian</h1>
    <hr>


<!-- Content appended here -->
<div class="franklin-content"><h1 id="パフォーマンスを維持したままjuliaらしく"><a href="#パフォーマンスを維持したままjuliaらしく" class="header-anchor">パフォーマンスを維持したままJuliaらしく</a></h1></p>
<p>      
<pre><code class="language-julia">using DelimitedFiles

function cnt&#40;ReZ, ImZ, ReC, ImC&#41;
    k::UInt8 &#61; 0
    while &#40;k &lt; 255&#41;
        new_ReZ &#61; ReZ * ReZ - ImZ * ImZ &#43; ReC
        new_ImZ &#61; 2 * ReZ * ImZ &#43; ImC
        if new_ReZ * new_ReZ &#43; new_ImZ * new_ImZ &gt; 4.
            return k
        end
        ReZ &#61; new_ReZ
        ImZ &#61; new_ImZ
        k &#43;&#61; 1
    end
    return k
end

function mand&#40;M,N&#41;
    grid &#61; Array&#123;UInt8&#125;&#40;undef, M, N&#41;
    init_Re &#61; 0.0
    init_Im &#61; 0.0
    for j &#61; 1:N
        for i &#61; 1:M
            ReC &#61; 4.0 / &#40;M - 1&#41; * &#40;j - 1&#41; - 2.0
            ImC &#61; 4.0 / &#40;N - 1&#41; * &#40;i - 1&#41; - 2.0
            ReZ &#61; init_Re
            ImZ &#61; init_Im
            grid&#91;i, j&#93; &#61; cnt&#40;ReZ, ImZ, ReC, ImC&#41;
        end
    end
    return grid
end

function main&#40;&#41;
    s &#61; time&#40;&#41;
    M &#61; N &#61; 5000
    grid &#61; mand&#40;M,N&#41;
    t &#61; time&#40;&#41;
    @show&#40;t - s&#41;
    writedlm&#40;&quot;/tmp/resultJ.txt&quot;,grid,&quot;,&quot;&#41;
end

main&#40;&#41;

using BenchmarkTools
@btime mand&#40;5000, 5000&#41;;</code></pre>
<pre><code class="plaintext code-output">t - s = 3.013849973678589
  3.005 s (2 allocations: 23.84 MiB)
</code></pre>
  </p>
<p><div class="colorblock"><strong>Remark</strong> 5.0.1 &#40;数値誤差について&#41; <br/>  点の位置をあらわす <code>&#40;4.0 / &#40;M - 1&#41; * &#40;j - 1&#41; - 2.0&#41;</code> は <code>range&#40;-2, 2, length&#40;N&#41;&#41;</code> と数学的に等価ですが，数値の誤差の関係で結果が若干異なることがあります．</div>
<pre><code class="language-julia">N&#61;10; @show &#91;4.0*&#40;i-1&#41;/&#40;N-1&#41; - 2.0 for i in 1:N&#93;</code></pre>
<pre><code class="plaintext code-output">[(4.0 * (i - 1)) / (N - 1) - 2.0 for i = 1:N] = [-2.0, -1.5555555555555556, -1.1111111111111112, -0.6666666666666667, -0.22222222222222232, 0.22222222222222232, 0.6666666666666665, 1.1111111111111112, 1.5555555555555554, 2.0]
</code></pre>
<pre><code class="language-julia">N&#61;10; @show collect&#40;range&#40;-2,2,length&#61;N&#41;&#41;</code></pre>
<pre><code class="plaintext code-output">collect(range(-2, 2, length = N)) = [-2.0, -1.5555555555555556, -1.1111111111111112, -0.6666666666666666, -0.2222222222222222, 0.2222222222222222, 0.6666666666666666, 1.1111111111111112, 1.5555555555555556, 2.0]
</code></pre>
<pre><code class="language-julia">Tarpath&#61;&quot;/tmp/resultJ.txt&quot;
using Plots
gr&#40;&#41;
using DelimitedFiles
img &#61; readdlm&#40;Tarpath,&#39;,&#39;,Int&#41;
M,N &#61; img |&gt; size
p &#61; heatmap&#40;1:N,1:M,img,aspect_ratio&#61;1, size&#61;&#40;400, 400&#41;&#41;</code></pre>
<p><span style="color:red;">// Image matching '/assets/programming/benchmark_part2/code/mandJ' not found. //</span></p>
<pre><code class="language-julia">using DelimitedFiles

function cnt&#40;z,c&#41;
    k::UInt8 &#61; 0
    while &#40;k &lt; 255&#41;
        z &#61; z^2 &#43; c
        if abs2&#40;z&#41;&gt;4.
            return k
        end
        k &#43;&#61; 1
    end
    return k
end

function mand&#40;M, N&#41;
    grid &#61; Array&#123;UInt8&#125;&#40;undef, M, N&#41;
    init_z &#61; complex&#40;0.0, 0.0&#41;
    xs &#61; range&#40;-2,2,length&#61;N&#41;
    ys &#61; range&#40;-2,2,length&#61;M&#41;
    for &#40;i,x&#41; in enumerate&#40;xs&#41;
        for &#40;j,y&#41; in enumerate&#40;ys&#41;
            grid&#91;j, i&#93; &#61; cnt&#40;init_z,complex&#40;x, y&#41;&#41;
        end
    end
    return grid
end

function main&#40;&#41;
    s &#61; time&#40;&#41;
    M &#61; N &#61; 5000
    grid &#61; mand&#40;M, N&#41;
    t &#61; time&#40;&#41;
    @show&#40;t - s&#41;
    writedlm&#40;&quot;/tmp/resultJ1.txt&quot;,grid,&quot;,&quot;&#41;
end

main&#40;&#41;

using BenchmarkTools
@btime mand&#40;5000, 5000&#41;;</code></pre>
<pre><code class="plaintext code-output">t - s = 3.164144992828369
  3.163 s (2 allocations: 23.84 MiB)
</code></pre>
<pre><code class="language-julia">Refpath&#61;&quot;/tmp/resultJ.txt&quot;
Tarpath&#61;&quot;/tmp/resultJ1.txt&quot;
run&#40;&#96;bash -c &quot;cmp --silent &#36;Refpath &#36;Tarpath || echo \&quot;files are different\&quot;&quot;&#96;&#41;

using Plots
gr&#40;&#41;
using DelimitedFiles
img &#61; readdlm&#40;Tarpath,&#39;,&#39;,Int&#41;
M,N &#61; img |&gt; size
p &#61; heatmap&#40;1:N,1:M,img,aspect_ratio&#61;1, size&#61;&#40;400, 400&#41;&#41;</code></pre>
<pre><code class="plaintext code-output">files are different
Failed to precompile Plots [91a5bcdd-55d7-5caf-9e0b-520d859cae80] to /root/.julia/compiled/v1.7/Plots/jl_rm77Cf.
</code></pre>
<p><span style="color:red;">// Image matching '/assets/programming/benchmark_part2/code/mandJ1' not found. //</span></p>
<pre><code class="language-julia">using DelimitedFiles

function cnt&#40;z,c&#41;
    k::UInt8 &#61; 0
    while &#40;k &lt; 255&#41;
        z &#61; z^2 &#43; c
        if abs2&#40;z&#41;&gt;4.
            return k
        end
        k &#43;&#61; 1
    end
    return k
end

function mand&#40;M, N&#41;
    grid &#61; Array&#123;UInt8&#125;&#40;undef, M, N&#41;
    init_z &#61; complex&#40;0.0, 0.0&#41;
    xs &#61; range&#40;-2,2,length&#61;N&#41;
    ys &#61; range&#40;-2,2,length&#61;M&#41;
    grid &#61; cnt.&#40;init_z,complex.&#40;xs&#39;,ys&#41;&#41;
    return grid
end

function main&#40;&#41;
    s &#61; time&#40;&#41;
    M &#61; N &#61; 5000
    grid &#61; mand&#40;M, N&#41;
    t &#61; time&#40;&#41;
    @show&#40;t - s&#41;
    writedlm&#40;&quot;/tmp/resultJ2.txt&quot;,grid,&quot;,&quot;&#41;
end

main&#40;&#41;

using BenchmarkTools
@btime mand&#40;5000, 5000&#41;;</code></pre>
<pre><code class="plaintext code-output">t - s = 3.1704351902008057
  3.136 s (4 allocations: 47.68 MiB)
</code></pre>
<pre><code class="language-julia">Refpath&#61;&quot;/tmp/resultJ1.txt&quot;
Tarpath&#61;&quot;/tmp/resultJ2.txt&quot;
run&#40;&#96;bash -c &quot;cmp --silent &#36;Refpath &#36;Tarpath || echo \&quot;files are different\&quot;&quot;&#96;&#41;

using Plots
gr&#40;&#41;
using DelimitedFiles
img &#61; readdlm&#40;Tarpath,&#39;,&#39;,Int&#41;
M,N &#61; img |&gt; size
p &#61; heatmap&#40;1:N,1:M,img,aspect_ratio&#61;1, size&#61;&#40;400, 400&#41;&#41;</code></pre>
<pre><code class="plaintext code-output">Failed to precompile Plots [91a5bcdd-55d7-5caf-9e0b-520d859cae80] to /root/.julia/compiled/v1.7/Plots/jl_Q28qTg.
</code></pre>
<p><span style="color:red;">// Image matching '/assets/programming/benchmark_part2/code/mandJ2' not found. //</span></p>
<pre><code class="language-julia">#&#61;
set environment variable &#96;JULIA_NUM_THREADS&#61;8&#96; before julia begins
&#61;#
using DelimitedFiles

function cnt&#40;z,c&#41;
    k::UInt8 &#61; 0
    while &#40;k &lt; 255&#41;
        z &#61; z^2 &#43; c
        if abs2&#40;z&#41;&gt;4.
            return k
        end
        k &#43;&#61; 1
    end
    return k
end

function mand&#40;M, N&#41;
    grid &#61; Array&#123;UInt8&#125;&#40;undef, M, N&#41;
    init_z &#61; complex&#40;0.0, 0.0&#41;
    xs &#61; range&#40;-2,2,length&#61;N&#41;
    ys &#61; range&#40;-2,2,length&#61;M&#41;
    Base.Threads.@threads for i in 1:N
        for j in 1:M
            grid&#91;j, i&#93; &#61; cnt&#40;init_z,complex&#40;xs&#91;i&#93;, ys&#91;j&#93;&#41;&#41;
        end
    end
    return grid
end

function main&#40;&#41;
    s &#61; time&#40;&#41;
    M &#61; N &#61; 5000
    grid &#61; mand&#40;M, N&#41;
    t &#61; time&#40;&#41;
    @show&#40;t - s&#41;
    writedlm&#40;&quot;/tmp/resultJ3.txt&quot;,grid,&quot;,&quot;&#41;
end

main&#40;&#41;

using BenchmarkTools
@btime mand&#40;5000, 5000&#41;;</code></pre>
<pre><code class="plaintext code-output">t - s = 2.064563035964966
  1.815 s (46 allocations: 23.85 MiB)
</code></pre>
<pre><code class="language-julia">Refpath&#61;&quot;/tmp/resultJ1.txt&quot;
Tarpath&#61;&quot;/tmp/resultJ3.txt&quot;
run&#40;&#96;bash -c &quot;cmp --silent &#36;Refpath &#36;Tarpath || echo \&quot;files are different\&quot;&quot;&#96;&#41;

using Plots
gr&#40;&#41;

using DelimitedFiles
img &#61; readdlm&#40;Tarpath, &#39;,&#39;, Int&#41;
M,N &#61; img |&gt; size
p &#61; heatmap&#40;1:N, 1:M, img,aspect_ratio&#61;1, size&#61;&#40;400, 400&#41;&#41;
savefig&#40;p, joinpath&#40;@OUTPUT, &quot;mandJ3.png&quot;&#41;&#41;</code></pre>
<pre><code class="plaintext code-output">Failed to precompile Plots [91a5bcdd-55d7-5caf-9e0b-520d859cae80] to /root/.julia/compiled/v1.7/Plots/jl_GVymri.
</code></pre>
<p><span style="color:red;">// Image matching '/assets/programming/benchmark_part2/code/mandJ3' not found. //</span></p>
<div class="page-foot">
  <div class="copyright">
    &copy; SatoshiTerasaki. Last modified: 2022年3月13日 日曜日. Website built with 
    <a href="http://github.com/terasakisatoshi/MathSeminar.jl">MathSeminar.jl</a>
    <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a>.
  </div>
</div>
</div><!-- CONTENT ENDS HERE -->
  </main> <!-- end of id=main -->
  <script src="/MathSeminar.jl/libs/vela/metisMenu.min.js"></script>
  <script src="/MathSeminar.jl/libs/vela/slideout.min.js"></script>
  
    <script src="/MathSeminar.jl/libs/katex/katex.min.js"></script>
<script src="/MathSeminar.jl/libs/katex/auto-render.min.js"></script>
<script>renderMathInElement(document.body)</script>

  
  
    <script src="/MathSeminar.jl/libs/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script>

  
</body>
</html>
