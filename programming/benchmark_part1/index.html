<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
   <link rel="stylesheet" href="/MathSeminar.jl/libs/katex/katex.min.css">
   
   <link rel="stylesheet" href="/MathSeminar.jl/libs/highlight/github.min.css">
   
  

  <link href="/MathSeminar.jl/css/franklin.css" rel="stylesheet">
  <link href="/MathSeminar.jl/css/vela.css" rel="stylesheet">
  <script src="/MathSeminar.jl/libs/vela/jquery.min.js"></script>
  <link rel="stylesheet" href="/MathSeminar.jl/css/theorem.css">
   <title>How fast is Julia language?</title>  
  <!-- PLOTLY -->
   <script src="/MathSeminar.jl/libs/plotly/plotly.min.js"></script> 

  <title>Franklin Example | Vela</title>
</head>
<body>
  <div class="main-nav" id="menu">
    <div class="flex-container">
      <span class="sidebar-brand">
        <h3 style='font-size: 25px'>MathSeminar.jl</h3>
      </span>
    </div> <!-- class="flex-container" -->

    <nav class="sidebar-nav">
      <ul class="metismenu"  id="metismenu" >
        <li><a href="/MathSeminar.jl/index.html">Home</a></li>
        <li><a href="" class="has-arrow">Slide Show</a>
          <ul>
            <li><a href="/MathSeminar.jl/slideshow/remark/build/">Introduction to Remark.jl</a>
            <li><a href="/MathSeminar.jl/slideshow/franklin/build">Introduction to Franklin.jl</a>
            <li><a href="/MathSeminar.jl/slideshow/dash/build">Introduction to Dash.jl</a>
            <li><a href="/MathSeminar.jl/slideshow/binarybuilder/build">Introduction to BinaryBuilder.jl</a>
            <li><a href="/MathSeminar.jl/slideshow/myworkflow/build">Introduction to MyWorkflow.jl</a>
            <li><a href="/MathSeminar.jl/slideshow/repl/build">Do something great in your REPL</a>
            <li><a href="/MathSeminar.jl/slideshow/intro2julia/build">Into2Julia</a>
            <li><a href="/MathSeminar.jl/slideshow/pycallchainrules/build">PyCallChainRules.jl</a>
            <li><a href="/MathSeminar.jl/slideshow/replay/build">Replay.jl</a>
          </ul>
        </li>
        <li><a href="" class="has-arrow">Programming</a>
          <ul>
            <li><a href="/MathSeminar.jl/programming/clang">C</a></li>
            <li><a href="/MathSeminar.jl/programming/rust">Rust</a></li>
            <li><a href="/MathSeminar.jl/programming/benchmark_part1"> Julia benchmark Part1 </a></li>
            <li><a href="/MathSeminar.jl/programming/benchmark_part2"> Julia benchmark Part2 </a></li>
            <li><a href="/MathSeminar.jl/programming/literatejl">Literate.jl</a></li>
            <li><a href="/MathSeminar.jl/programming/sympy">SymPy.jl</a></li>
            <li><a href="/MathSeminar.jl/programming/franklin">Franklin.jl</a></li>
            <li><a href="/MathSeminar.jl/programming/weave">Weave.jl</a></li>
            <li><a href="/MathSeminar.jl/programming/theoremcounter">Theorem Counter</a></li>
            <li><a href="/MathSeminar.jl/programming/images">Images.jl</a></li>
            <li><a href="/MathSeminar.jl/programming/rcall">RCall.jl</a></li>
            <li><a href="/MathSeminar.jl/programming/asciinema">asciinema</a></li>
          </ul>
        </li>
        <li><a href="" class="has-arrow">Gallery</a>
          <ul>
            <li><a href="/MathSeminar.jl/gallery/animation/">Plots.jl animation</a></li>
            <li><a href="/MathSeminar.jl/gallery/curve/">Plots.jl curve</a></li>
            <li><a href="/MathSeminar.jl/gallery/gr/">GR.jl</a></li>
            <li><a href="/MathSeminar.jl/gallery/plotlyjs1/">PlotlyJS.jl Part1</a></li>
            <li><a href="/MathSeminar.jl/gallery/plotlyjs2/">PlotlyJS.jl Part2</a></li>
            <li><a href="/MathSeminar.jl/gallery/plotlyjs3/">PlotlyJS.jl Part3</a></li>
            <li><a href="/MathSeminar.jl/gallery/jsxgraph_js/">JSXGraph (JS)</a></li>
            <li><a href="/MathSeminar.jl/gallery/jsxgraph_jl/">JSXGraph (Julia)</a></li>
            <li><a href="/MathSeminar.jl/gallery/wglmakie/">WGLMakie.jl</a></li>
          </ul>
        </li>
        <li><a href="" class="has-arrow">Topics in Mathematics</a>
          <ul>
            <li><a href="/MathSeminar.jl/mathematics/linearalgebra/chapter0">Linear Algebra</a></li>
            <li><a href="/MathSeminar.jl/mathematics/statistics/dice">Dice</a></li>
            <li><a href="/MathSeminar.jl/mathematics/statistics/Chisq">Chisq Distributions</a></li>
            <li><a href="/MathSeminar.jl/mathematics/statistics/Law_of_Large_Numbers">Law_of_Large_Numbers</a></li>
            <li><a href="/MathSeminar.jl/mathematics/visualizations/triangular_function_addition_theorem">Triangular function addition theorem</a></li>
          </ul>
        </li>
      </ul>
    </nav>
  </div> <!-- main nav menu -->

  <main id="panel">
    <div class="toggle-button hamburger hamburger--spin">
      <div class="hamburger-box">
        <div class="hamburger-inner"></div>
      </div>
    </div>
    <h1 class="page title">How fast is Julia language?</h1>
    <hr>


<!-- Content appended here -->
<div class="franklin-content"><h1 id="is_julia_fast"><a href="#is_julia_fast" class="header-anchor">Is Julia fast ?</a></h1></p>
<p>      
<ul>
<li><p>Julia は LLVM による JIT コンパイルにより高速に動作し C 言語と同等のスピードを出すことができます。ここではベンチマークとしてマンデルブロ集合の生成する計算を例にJulia がどれくらいのパフォーマンスを出すのかを調べてみましょう。</p>
</li>
</ul>
<h2 id="c_のコードを書く"><a href="#c_のコードを書く" class="header-anchor">C のコードを書く</a></h2></p>
<p>    
<ul>
<li><p>C のコードを書いてみました.</p>
</li>
</ul>
</p>
<p><pre><code class="c hljs"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;time.h&gt;</span></span>

<span class="hljs-type">uint8_t</span> <span class="hljs-title function_">cnt</span><span class="hljs-params">(<span class="hljs-type">double</span> ReZ,<span class="hljs-type">double</span> ImZ,<span class="hljs-type">double</span> ReC,<span class="hljs-type">double</span> ImC)</span>{
    <span class="hljs-type">uint8_t</span> k=<span class="hljs-number">0</span>;
    <span class="hljs-keyword">while</span>(k &lt; <span class="hljs-number">255</span>){
        <span class="hljs-type">double</span> new_ReZ = ReZ * ReZ - ImZ * ImZ + ReC ;
        <span class="hljs-type">double</span> new_ImZ = <span class="hljs-number">2</span> * ReZ * ImZ + ImC;
        <span class="hljs-keyword">if</span> (new_ReZ * new_ReZ+new_ImZ * new_ImZ&gt;<span class="hljs-number">4</span>){
            <span class="hljs-keyword">return</span> k;
        }
        ReZ = new_ReZ;
        ImZ = new_ImZ;
        k+=<span class="hljs-number">1</span>;
    }
    <span class="hljs-keyword">return</span> k;
}


<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>
{
    <span class="hljs-type">clock_t</span> start,end;
    start = clock();
    <span class="hljs-type">int</span> M = <span class="hljs-number">1250</span>;
    <span class="hljs-type">int</span> N = <span class="hljs-number">1250</span>;
    <span class="hljs-type">uint8_t</span> grid[M][N];
    <span class="hljs-type">double</span> init_Re = <span class="hljs-number">0.0</span>;
    <span class="hljs-type">double</span> init_Im = <span class="hljs-number">0.0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; M; j++)
    {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; N; i++)
        {
            <span class="hljs-type">double</span> ReC = <span class="hljs-number">4.0</span> / (N - <span class="hljs-number">1</span>) * i - <span class="hljs-number">2.0</span>;
            <span class="hljs-type">double</span> ImC = <span class="hljs-number">4.0</span> / (M - <span class="hljs-number">1</span>) * j - <span class="hljs-number">2.0</span>;
            <span class="hljs-type">double</span> ReZ = init_Re;
            <span class="hljs-type">double</span> ImZ = init_Im;
            grid[j][i] = cnt(ReZ,ImZ,ReC,ImC);
        }
    }
    end = clock();
    <span class="hljs-type">double</span> cpu_time_used = ((<span class="hljs-type">double</span>) (end - start)) / CLOCKS_PER_SEC;
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Elapsed time %f [sec]\n&quot;</span>, cpu_time_used);
    FILE *fp;
    fp = fopen(<span class="hljs-string">&quot;/tmp/benchC.txt&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; M; j++)
    {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; N; i++)
        {
            <span class="hljs-built_in">fprintf</span>(fp, <span class="hljs-string">&quot;%d&quot;</span>, grid[j][i]);
            <span class="hljs-keyword">if</span> (i != N - <span class="hljs-number">1</span>)
            {
                <span class="hljs-built_in">fprintf</span>(fp, <span class="hljs-string">&quot;,&quot;</span>);
            }
            <span class="hljs-keyword">else</span>
            {
                <span class="hljs-built_in">fprintf</span>(fp, <span class="hljs-string">&quot;\n&quot;</span>);
            }
        }
    }
    fclose(fp);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}</code></pre></p>
<p><pre><code class="plaintext hljs">Elapsed time 0.156365 [sec]
</code></pre>
<p>描画は下記のとおりです。</p>
<pre><code class="julia hljs"><span class="hljs-keyword">using</span> DelimitedFiles
<span class="hljs-keyword">using</span> Plots
gr()
img = readdlm(<span class="hljs-string">&quot;/tmp/benchC.txt&quot;</span>,<span class="hljs-string">&#x27;,&#x27;</span>,<span class="hljs-built_in">Int</span>)
M,N = img |&gt; size
p=heatmap(<span class="hljs-number">1</span>:N, <span class="hljs-number">1</span>:M, img, aspect_ratio=<span class="hljs-number">1</span>, size=(<span class="hljs-number">400</span>,<span class="hljs-number">400</span>))</code></pre>
<p><span style="color:red;">// Image matching '/assets/programming/benchmark_part1/code/mandC.png' not found. //</span></p>
<h2 id="julia_のコード"><a href="#julia_のコード" class="header-anchor">Julia のコード</a></h2></p>
<p>    
<p>最後に Julia のコードを見ていきましょう</p>
<pre><code class="julia hljs"><span class="hljs-keyword">using</span> DelimitedFiles

<span class="hljs-keyword">function</span> cnt(ReZ, ImZ, ReC, ImC)
    k::<span class="hljs-built_in">UInt8</span> = <span class="hljs-number">0</span>
    <span class="hljs-keyword">while</span> (k &lt; <span class="hljs-number">255</span>)
        new_ReZ = ReZ * ReZ - ImZ * ImZ + ReC
        new_ImZ = <span class="hljs-number">2</span> * ReZ * ImZ + ImC
        <span class="hljs-keyword">if</span> new_ReZ * new_ReZ + new_ImZ * new_ImZ &gt; <span class="hljs-number">4.</span>
            <span class="hljs-keyword">return</span> k
        <span class="hljs-keyword">end</span>
        ReZ = new_ReZ
        ImZ = new_ImZ
        k += <span class="hljs-number">1</span>
    <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">return</span> k
<span class="hljs-keyword">end</span>

<span class="hljs-keyword">function</span> cnt(z,c)
    k::<span class="hljs-built_in">UInt8</span> = <span class="hljs-number">0</span>
    <span class="hljs-keyword">while</span> (k &lt; <span class="hljs-number">255</span>)
        z = z^<span class="hljs-number">2</span> + c
        <span class="hljs-keyword">if</span> abs2(z)&gt;<span class="hljs-number">4.</span>
            <span class="hljs-keyword">return</span> k
        <span class="hljs-keyword">end</span>
        k += <span class="hljs-number">1</span>
    <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">return</span> k
<span class="hljs-keyword">end</span>

<span class="hljs-keyword">function</span> mand(M::<span class="hljs-built_in">Int</span>, N::<span class="hljs-built_in">Int</span>)
    grid = <span class="hljs-built_in">Array</span>{<span class="hljs-built_in">UInt8</span>}(<span class="hljs-literal">undef</span>, M, N)
    init_Re = <span class="hljs-number">0.0</span>
    init_Im = <span class="hljs-number">0.0</span>
    <span class="hljs-keyword">for</span> j = <span class="hljs-number">1</span>:M
        <span class="hljs-keyword">for</span> i = <span class="hljs-number">1</span>:N
            ReC = <span class="hljs-number">4.0</span> / (N - <span class="hljs-number">1</span>) * (i - <span class="hljs-number">1</span>) - <span class="hljs-number">2.0</span>
            ImC = <span class="hljs-number">4.0</span> / (M - <span class="hljs-number">1</span>) * (j - <span class="hljs-number">1</span>) - <span class="hljs-number">2.0</span>
            ReZ = init_Re
            ImZ = init_Im
            grid[j, i] = cnt(ReZ, ImZ, ReC, ImC)
        <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">return</span> grid
<span class="hljs-keyword">end</span>

<span class="hljs-keyword">function</span> main()
    s = time()
    M = N = <span class="hljs-number">1250</span>
    grid = mand(M,N)
    t = time()
    <span class="hljs-meta">@show</span>(t - s)
    writedlm(<span class="hljs-string">&quot;/tmp/benchJ.txt&quot;</span>,grid,<span class="hljs-string">&quot;,&quot;</span>)
<span class="hljs-keyword">end</span>

main()

<span class="hljs-keyword">using</span> BenchmarkTools
<span class="hljs-meta">@btime</span> mand(<span class="hljs-number">1250</span>, <span class="hljs-number">1250</span>);</code></pre>
<pre><code class="plaintext hljs">t - s = 0.18861103057861328
  188.379 ms (2 allocations: 1.49 MiB)
</code></pre>
<pre><code class="julia hljs">Refpath=<span class="hljs-string">&quot;/tmp/benchC.txt&quot;</span>
Tarpath=<span class="hljs-string">&quot;/tmp/benchJ.txt&quot;</span>
run(<span class="hljs-string">`bash -c &quot;cmp --silent <span class="hljs-variable">$Refpath</span> <span class="hljs-variable">$Tarpath</span> || echo \&quot;files are different\&quot;&quot;`</span>)

<span class="hljs-keyword">using</span> Plots
gr()
<span class="hljs-keyword">using</span> DelimitedFiles
img = readdlm(Tarpath,<span class="hljs-string">&#x27;,&#x27;</span>,<span class="hljs-built_in">Int</span>)
M,N = img |&gt; size
p = heatmap(<span class="hljs-number">1</span>:N,<span class="hljs-number">1</span>:M,img,aspect_ratio=<span class="hljs-number">1</span>, size=(<span class="hljs-number">400</span>, <span class="hljs-number">400</span>))</code></pre>
<pre><code class="plaintext hljs">Failed to precompile Plots [91a5bcdd-55d7-5caf-9e0b-520d859cae80] to /root/.julia/compiled/v1.7/Plots/jl_E39LOh.
</code></pre>
<p><span style="color:red;">// Image matching '/assets/programming/benchmark_part1/code/mandJ.png' not found. //</span></p>
<div class="page-foot">
  <div class="copyright">
    &copy; SatoshiTerasaki. Last modified: 2022年5月25日 水曜日. Website built with 
    <a href="http://github.com/terasakisatoshi/MathSeminar.jl">MathSeminar.jl</a>
    <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a>.
  </div>
</div>
</div><!-- CONTENT ENDS HERE -->
  </main> <!-- end of id=main -->
  <script src="/MathSeminar.jl/libs/vela/metisMenu.min.js"></script>
  <script src="/MathSeminar.jl/libs/vela/slideout.min.js"></script>
  
    



  
  
    


  
</body>
</html>
