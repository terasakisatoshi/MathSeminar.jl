.phony : all, build, slide, frankln, web, trace, clean

OS:=$(shell uname -s)

all: build

build:
	rm -f Manifest.toml
	docker-compose build
	docker-compose run --rm julia julia -e 'using Pkg; Pkg.instantiate()'

slide:
	docker-compose run --rm julia julia -e 'using Pkg; Pkg.instantiate(); using Remark; Remark.slideshow("slideshow/example.jl","slideshow")'

franklin:
	# serve web page without creating slide generated by Remark.jl
	docker-compose up franklin

web:
	# serve web page including creating slide generated by Remark.jl
	docker-compose up web

trace:
	rm -f Manifest.toml
	docker build -t seminartrace -f _mytools/Dockerfile .
	docker run --rm -it -v ${PWD}:/work -w /work seminartrace julia -e 'using Pkg; Pkg.instantiate()'
	docker run --rm -it -v ${PWD}:/work -w /work seminartrace julia --trace-compile=./.statements/franklin.jl --project=@. -e 'using Franklin; serve()'

clean:
	docker-compose down
	rm -f  Manifest.toml # reset Manifest.toml
	rm -rf slideshow/src slideshow/build # assets generated by Remark.jl
	rm -rf __site # assets generated by Franklin.jl
