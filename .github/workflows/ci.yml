name: CI
on:
  - push
  - pull_request

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v2
      with:
        persist-credentials: false
    # Python is necessary for pre-rendering steps as well as to install
    # matplotlib which is necessary if you intend to use PyPlot. If you do
    # not, then you can remove the `run: pip install matplotlib` line.
    - name: Install python
      uses: actions/setup-python@v1
      with:
        python-version: '3.x'
    # Install apt package for GR
    - run: sudo apt-get update && sudo apt-get install libxt6 libxrender1 libxext6 libgl1-mesa-glx libqt5widgets5
    # LaTeXStrings
    - run: sudo apt-get update && sudo apt-get install dvipng texlive-latex-recommended
    - run: pip install numpy matplotlib # if you use PyPlot this is needed
    - name: Install Julia
      uses: julia-actions/setup-julia@v1
      with:
        version: 1.4.0
    # This ensures that NodeJS and Franklin are loaded then it installs
    # highlight.js which is needed for the prerendering step.
    # Then the environment is activated and instantiated to install all
    # Julia packages which may be required to successfully build your site.
    # NOTE: the last line should be `optimize()`, you may want to give it
    # specific arguments, see the documentation or ?optimize in the REPL.
    - run: julia -e '
            using Pkg; Pkg.add(["NodeJS", "Franklin", "Literate", "Remark"]);
            using Remark; Remark.slideshow("remark/example.jl", "./remark", );
            using NodeJS; run(`$(npm_cmd()) install highlight.js`);
            using Franklin;
            Pkg.activate("."); Pkg.instantiate();
            optimize()'
